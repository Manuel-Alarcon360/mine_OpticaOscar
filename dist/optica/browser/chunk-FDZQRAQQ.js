import{a as o,b as d}from"./chunk-PLY4SSHU.js";import{c as m,h as v}from"./chunk-6FFHPBTM.js";import{I as u,L as k,R as h,n as f}from"./chunk-3POYB5FS.js";import{g as p}from"./chunk-TSRGIXR5.js";var s="usuario/",l=(t=>(t.login=s+"login/",t.postRefreshToken=s+"token/refresh/",t.registro=s+"registra_usuarios/",t.list_colaboradores=s+"list_usuarios/",t.changeStatusEmployee=s+"update_estado_empleado/",t.logOut=s+"logout/",t.update_contrasenia=s+"update_contrasenia",t))(l||{});var g=class i{http=h(m);cookieService=h(d);URI=l;endpoint=v.apiUrl;_isRefreshing=!1;get isRefreshing(){return this._isRefreshing}set isRefreshing(e){this._isRefreshing=e}login(e){return this.http.post(`${this.endpoint}${this.URI.login}`,e).pipe(u(r=>{let n=r.access,c=o(n),a=o(r.refresh),y=c?.exp,t=new Date(y*1e3),b=a.exp,T=new Date(b*1e3);this.cookieService.set("tokenOptica",r.access,{expires:t,path:"/"}),this.cookieService.set("refreshOptica",r.refresh,{expires:T,path:"/"})}))}logOutSystem(){let e={refresh:this.cookieService.get("refreshOptica")};return this.http.post(`${this.endpoint}${this.URI.logOut}`,e)}addTokenHeader(e){let r=this.cookieService.get("tokenOptica");return e.clone({headers:e.headers.set("Authorization","Bearer "+r)})}refreshTokenAsync(){return p(this,null,function*(){try{let e={refresh:this.cookieService.get("refreshOptica")};return yield f(this.http.post(`${this.endpoint}${this.URI.postRefreshToken}`,e))}catch(e){return console.error("Error al refrescar el token:",e),null}})}refreshToken(){let e={refresh:this.cookieService.get("refreshOptica")};return this.http.post(`${this.endpoint}${this.URI.postRefreshToken}`,e)}updateToken(e){return p(this,null,function*(){try{if(!e.access){console.error("Error al actualizar el token:",e);return}let r=o(e.access),n=new Date(r.exp*1e3);if(this.cookieService.set("tokenOptica",e.access,{expires:n,path:"/"}),e.refresh){let c=o(e.refresh),a=new Date(c.exp*1e3);this.cookieService.set("refreshOptica",e.refresh,{expires:a,path:"/"})}}catch(r){console.error("Error en updateToken:",r,e)}})}changePasword(e){let r=`${this.endpoint}${this.URI.update_contrasenia}/${e.id}/`;return this.http.put(r,e)}static \u0275fac=function(r){return new(r||i)};static \u0275prov=k({token:i,factory:i.\u0275fac,providedIn:"root"})};export{l as a,g as b};
